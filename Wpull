-- Copyright 2025 JÃ´natas Venancio Teixeira
-- License: Apache-2.0

function sysCall_init()
    sim = require('sim')
    
    -- Put some initialization code here
    sim.setStepping(true) -- enabling stepping mode
end

function sysCall_thread()

    
    -- Put your main code here, e.g.:
    --
    while not sim.getSimulationStopping() do
        sim.waitForSignal("WPull")
        sim.waitForSignal("mp")
        P=sim.getInt32Signal("WPull")
        sim.setInt32Signal("RPull",P)
        mp=sim.getBufferSignal("mp")
        sim.wait(0.1)
        mp=sim.unpackTable(mp)
        for i=1, table.getn(mp) do
            --print(mp[i][1])
            if mp[i][1]==P then
                sim.setBufferSignal("WP",sim.packTable(mp[i][2]))
                print("mp[i][2]=")
                print(mp[i])
            end
        end
        sim.clearInt32Signal("WPull")
        sim.step();
    end
end

-- See the user manual or the available code snippets for additional callback functions and details
